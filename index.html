<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biostat Excel Lab - å‡½æ•¸å°„æ“ŠéŠæˆ²</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    const Target = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/>
      </svg>
    );

    const Heart = ({ size = 24, fill = "none", className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" className={className}>
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
      </svg>
    );

    const Trophy = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
        <path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
      </svg>
    );

    const Lightbulb = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/>
        <path d="M9 18h6"/><path d="M10 22h4"/>
      </svg>
    );

    const CheckCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
    );

    const XCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
    );

    const Beaker = ({ className = "" }) => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <path d="M4.5 3h15"/><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3"/><path d="M6 14h12"/>
      </svg>
    );

    const ExcelBalloonShooter = () => {
      const [gameState, setGameState] = useState('menu');
      const [score, setScore] = useState(0);
      const [lives, setLives] = useState(5);
      const [balloons, setBalloons] = useState([]);
      const [selectedBalloon, setSelectedBalloon] = useState(null);
      const [feedback, setFeedback] = useState(null);
      const [answeredIds, setAnsweredIds] = useState(new Set());
      const [showHint, setShowHint] = useState(false);

      const questionBank = [
        { id: 1, category: 'è‡¨åºŠçµ±è¨ˆ', situation: 'é¡¯è‘—æ€§åˆ¤æ–·', question: 'A1å„²å­˜æ ¼ç‚ºp-valueï¼Œè‹¥ <0.05 é¡¯ç¤º"Significant"ï¼Œå¦å‰‡é¡¯ç¤º"NS"', correctAnswer: '=IF(A1<0.05,"Significant","NS")', options: ['=IF(A1<0.05,"Significant","NS")', '=IF(A1<0.05,Significant,NS)', '=TEST(A1<0.05)', '=COUNTIF(A1<0.05)'], hint: 'IF(æ¢ä»¶, çœŸå€¼, å‡å€¼)', explanation: 'åœ¨çµ±è¨ˆæª¢å®šä¸­ï¼Œé€šå¸¸ä»¥ 0.05 ä½œç‚ºé¡¯è‘—æ°´æº–è‡¨ç•Œå€¼ã€‚', points: 150, color: 'bg-gradient-to-br from-rose-400 to-rose-600' },
        { id: 2, category: 'è¡Œæ”¿ç®¡ç†', situation: 'è¨ˆç®—å“¡å·¥å¹´è³‡', question: 'A1ç‚ºåˆ°è·æ—¥ï¼Œè¨ˆç®—åˆ°ä»Šå¤©ç‚ºæ­¢çš„å®Œæ•´å¹´è³‡ï¼ˆå¹´ï¼‰', correctAnswer: '=DATEDIF(A1,TODAY(),"Y")', options: ['=DATEDIF(A1,TODAY(),"Y")', '=YEAR(TODAY()-A1)', '=(TODAY()-A1)/365', '=YEARFRAC(A1,TODAY())'], hint: 'DATEDIFç¬¬ä¸‰åƒæ•¸"Y"ä»£è¡¨å®Œæ•´å¹´æ•¸', explanation: 'ç”¨æ–¼è¨ˆç®—å“¡å·¥å¹´è³‡ã€ç—…æ‚£è¿½è¹¤å¹´é™ç­‰ã€‚', points: 120, color: 'bg-gradient-to-br from-amber-400 to-orange-600' },
        { id: 3, category: 'è³‡æ–™æ¸…æ´—', situation: 'ç§»é™¤ç—…æ­·è™Ÿç©ºç™½', question: 'A1 å…§å®¹ç‚º " 880123 "ï¼Œè«‹ç§»é™¤å‰å¾Œå¤šé¤˜ç©ºæ ¼', correctAnswer: '=TRIM(A1)', options: ['=TRIM(A1)', '=CLEAN(A1)', '=REMOVE(A1," ")', '=LEFT(A1,6)'], hint: 'TRIM ç”¨æ–¼åˆªé™¤å­—ä¸²å‰å¾Œç©ºæ ¼', explanation: 'åœ¨è‡¨åºŠè³‡æ–™ä¸²æ¥å‰ï¼ŒTRIM æ˜¯éå¸¸é‡è¦çš„æ­¥é©Ÿã€‚', points: 100, color: 'bg-gradient-to-br from-emerald-400 to-teal-600' },
        { id: 4, category: 'é€²éšæŸ¥æ‰¾', situation: 'è—¥ç‰©äº¤äº’ä½œç”¨æŸ¥è©¢', question: 'åœ¨è—¥å…¸è¡¨ $G$2:$H$100 æŸ¥æ‰¾ A1 è—¥ç¢¼ï¼Œå›å‚³ç¬¬ 2 æ¬„èªªæ˜', correctAnswer: '=VLOOKUP(A1,$G$2:$H$100,2,0)', options: ['=VLOOKUP(A1,$G$2:$H$100,2,0)', '=VLOOKUP(A1,G2:H100,2,1)', '=LOOKUP(A1,G2,H2)', '=MATCH(A1,G2:H100,0)'], hint: 'ç²¾ç¢ºåŒ¹é…è«‹ä½¿ç”¨ 0 æˆ– FALSE', explanation: '$ ç¬¦è™Ÿé–å®šç¯„åœï¼Œæ‹–æ›³å…¬å¼æ™‚æ‰ä¸æœƒè·‘æ‰ã€‚', points: 250, color: 'bg-gradient-to-br from-violet-500 to-purple-700' },
        { id: 5, category: 'æ—¥æœŸé‹ç®—', situation: 'è¨ˆç®—æ”¶æ¡ˆå¤©æ•¸', question: 'A1 ç‚ºæ”¶æ¡ˆæ—¥ï¼Œè¨ˆç®—åˆ°ä»Šå¤©ç‚ºæ­¢å…±æ”¶æ¡ˆå¹¾å€‹æœˆ', correctAnswer: '=DATEDIF(A1,TODAY(),"M")', options: ['=DATEDIF(A1,TODAY(),"M")', '=(TODAY()-A1)/30', '=MONTHS(A1,TODAY())', '=DATEDIF(A1,TODAY(),"D")'], hint: 'DATEDIF ç¬¬ä¸‰åƒæ•¸ "M" ä»£è¡¨æœˆä»½', explanation: 'DATEDIF æ˜¯è™•ç†è¿½è¹¤ç ”ç©¶æ™‚é–“çš„ç²¾ç¢ºéš±è—å‡½æ•¸ã€‚', points: 180, color: 'bg-gradient-to-br from-cyan-400 to-blue-600' },
        { id: 6, category: 'æ¢ä»¶çµ±è¨ˆ', situation: 'è¨ˆç®—é«˜é½¡å—è©¦è€…æ•¸', question: 'B æ¬„ç‚ºå¹´é½¡ï¼Œè¨ˆç®—å¹´é½¡ >= 65 çš„äººæ•¸', correctAnswer: '=COUNTIF(B:B,">=65")', options: ['=COUNTIF(B:B,">=65")', '=COUNT(B:B,">65")', '=SUMIF(B:B,">=65")', '=COUNTIFS(B:B,65)'], hint: 'æ¢ä»¶å¿…é ˆä»¥é›™å¼•è™ŸåŒ…åœ', explanation: 'COUNTIF ç”¨æ–¼å–®ä¸€æ¢ä»¶è¨ˆæ•¸ï¼Œè‡¨åºŠæ”¶æ¡ˆçµ±è¨ˆå¸¸ç”¨ã€‚', points: 130, color: 'bg-gradient-to-br from-lime-400 to-green-600' },
        { id: 7, category: 'æ–‡å­—è™•ç†', situation: 'æå–èº«åˆ†è­‰å­—è™Ÿ', question: 'A1å…§å®¹ç‚º"ç‹å°æ˜_A123456789"ï¼Œè«‹æå–åº•ç·šå¾Œçš„èº«åˆ†è­‰å­—è™Ÿ', correctAnswer: '=RIGHT(A1,10)', options: ['=RIGHT(A1,10)', '=MID(A1,5,10)', '=EXTRACT(A1,"_")', '=LEFT(A1,10)'], hint: 'RIGHT(æ–‡å­—,å­—å…ƒæ•¸)', explanation: 'èº«åˆ†è­‰å­—è™Ÿå›ºå®š10ç¢¼ï¼Œç”¨RIGHTå¾å³å´æå–ã€‚', points: 140, color: 'bg-gradient-to-br from-pink-400 to-rose-600' },
        { id: 8, category: 'è¡Œæ”¿ç®¡ç†', situation: 'è¨ˆç®—åŠ ç­è²»', question: 'A1ç‚ºæ™‚è–ª150ï¼ŒB1ç‚ºåŠ ç­æ™‚æ•¸ï¼ŒåŠ ç­è²»ç‚ºæ™‚è–ª1.5å€è¨ˆç®—', correctAnswer: '=A1*B1*1.5', options: ['=A1*B1*1.5', '=A1*B1+50%', '=(A1+50%)*B1', '=A1*1.5+B1'], hint: 'åŠ ç­è²» = æ™‚è–ª Ã— æ™‚æ•¸ Ã— å€ç‡', explanation: 'ä¾å‹åŸºæ³•ï¼ŒåŠ ç­è²»é€šå¸¸ç‚ºå¹³æ—¥å·¥è³‡çš„1.34æˆ–1.67å€ã€‚', points: 110, color: 'bg-gradient-to-br from-yellow-400 to-amber-600' },
        { id: 9, category: 'è‡¨åºŠçµ±è¨ˆ', situation: 'è¨ˆç®—å­˜æ´»ç‡', question: 'A1ç‚ºå­˜æ´»äººæ•¸ï¼ŒB1ç‚ºç¸½æ”¶æ¡ˆæ•¸ï¼Œè¨ˆç®—ç™¾åˆ†æ¯”å­˜æ´»ç‡ä¸¦ä¿ç•™2ä½å°æ•¸', correctAnswer: '=ROUND(A1/B1*100,2)', options: ['=ROUND(A1/B1*100,2)', '=A1/B1*100', '=ROUND(A1/B1,2)', '=PERCENT(A1/B1)'], hint: 'ROUND(æ•¸å€¼, å°æ•¸ä½æ•¸)', explanation: 'ROUNDå‡½æ•¸åœ¨è‡¨åºŠå ±å‘Šä¸­ç¢ºä¿æ•¸æ“šå‘ˆç¾ä¸€è‡´æ€§ã€‚', points: 160, color: 'bg-gradient-to-br from-indigo-400 to-blue-600' },
        { id: 10, category: 'è¤‡åˆå‡½æ•¸', situation: 'è—¥ç‰©åŠ‘é‡åˆ†ç´š', question: 'A1ç‚ºè‚Œé…é…¸(Cr)ï¼Œè‹¥Cr>2é¡¯ç¤º"æ¸›é‡50%"ï¼Œ1-2é¡¯ç¤º"æ¸›é‡25%"ï¼Œ<1é¡¯ç¤º"æ­£å¸¸åŠ‘é‡"', correctAnswer: '=IF(A1>2,"æ¸›é‡50%",IF(A1>=1,"æ¸›é‡25%","æ­£å¸¸åŠ‘é‡"))', options: ['=IF(A1>2,"æ¸›é‡50%",IF(A1>=1,"æ¸›é‡25%","æ­£å¸¸åŠ‘é‡"))', '=IF(A1>2,"æ¸›é‡50%","æ­£å¸¸åŠ‘é‡")', '=SWITCH(A1,2,"æ¸›é‡50%",1,"æ¸›é‡25%")', '=IFS(A1>2,"æ¸›é‡50%",A1>1,"æ¸›é‡25%")'], hint: 'å¤šå±¤IFï¼šIF(æ¢ä»¶1, å€¼1, IF(æ¢ä»¶2, å€¼2, å€¼3))', explanation: 'å·¢ç‹€IFå¯è™•ç†å¤šæ¢ä»¶åˆ¤æ–·ï¼Œå¸¸ç”¨æ–¼è‡¨åºŠæ±ºç­–æ”¯æ´ã€‚', points: 280, color: 'bg-gradient-to-br from-fuchsia-500 to-purple-700' },
        { id: 11, category: 'è³‡æ–™é©—è­‰', situation: 'æª¢æŸ¥ç—…æ­·è™Ÿæ ¼å¼', question: 'A1æ‡‰ç‚º7ä½æ•¸å­—ï¼Œæª¢æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼ˆæ­£ç¢ºé¡¯ç¤º"OK"ï¼ŒéŒ¯èª¤é¡¯ç¤º"æ ¼å¼éŒ¯èª¤"ï¼‰', correctAnswer: '=IF(LEN(A1)=7,"OK","æ ¼å¼éŒ¯èª¤")', options: ['=IF(LEN(A1)=7,"OK","æ ¼å¼éŒ¯èª¤")', '=IF(A1=7,"OK","æ ¼å¼éŒ¯èª¤")', '=LEN(A1)=7', '=ISTEXT(A1)'], hint: 'LEN()è¨ˆç®—å­—å…ƒæ•¸', explanation: 'LENå‡½æ•¸ç”¨æ–¼é©—è­‰è³‡æ–™é•·åº¦ï¼Œç¢ºä¿è¼¸å…¥æ­£ç¢ºæ€§ã€‚', points: 140, color: 'bg-gradient-to-br from-teal-400 to-cyan-600' },
        { id: 12, category: 'è¡Œæ”¿ç®¡ç†', situation: 'é ç®—åŸ·è¡Œç‡', question: 'A1ç‚ºå·²æ”¯å‡ºé‡‘é¡ï¼ŒB1ç‚ºé ç®—ç¸½é¡ï¼Œè¨ˆç®—åŸ·è¡Œç‡ç™¾åˆ†æ¯”ï¼ˆä¿ç•™æ•´æ•¸ï¼‰', correctAnswer: '=INT(A1/B1*100)', options: ['=INT(A1/B1*100)', '=ROUND(A1/B1*100,0)', '=A1/B1', '=FLOOR(A1/B1*100)'], hint: 'INT()ç„¡æ¢ä»¶æ¨å»å°æ•¸', explanation: 'INTå’ŒROUNDéƒ½å¯ç”¨ï¼Œä½†INTæ›´å¸¸ç”¨æ–¼é ç®—å ±è¡¨ã€‚', points: 120, color: 'bg-gradient-to-br from-orange-400 to-red-600' },
        { id: 13, category: 'æ¢ä»¶çµ±è¨ˆ', situation: 'å¤šæ¢ä»¶ç¯©é¸', question: 'Bæ¬„ç‚ºæ€§åˆ¥ï¼ŒCæ¬„ç‚ºå¹´é½¡ï¼Œè¨ˆç®—å¥³æ€§ä¸”å¹´é½¡>50çš„äººæ•¸', correctAnswer: '=COUNTIFS(B:B,"å¥³",C:C,">50")', options: ['=COUNTIFS(B:B,"å¥³",C:C,">50")', '=COUNTIF(B:B,"å¥³",C:C,">50")', '=COUNT(B:B="å¥³",C:C>50)', '=SUMIFS(B:B,"å¥³",C:C,">50")'], hint: 'COUNTIFSå¯è™•ç†å¤šæ¢ä»¶', explanation: 'COUNTIFSæ˜¯è‡¨åºŠåˆ†çµ„çµ±è¨ˆçš„åˆ©å™¨ï¼Œå¯åŒæ™‚ç¯©é¸å¤šå€‹æ¢ä»¶ã€‚', points: 200, color: 'bg-gradient-to-br from-sky-400 to-indigo-600' },
        { id: 14, category: 'æ–‡å­—è™•ç†', situation: 'å§“åé®ç½©è™•ç†', question: 'A1ç‚ºå§“å"ç‹å¤§æ˜"ï¼Œå°‡åå­—æ”¹ç‚º"ç‹Oæ˜"ï¼ˆä¸­é–“å­—é®è”½ï¼‰', correctAnswer: '=LEFT(A1,1)&"O"&RIGHT(A1,1)', options: ['=LEFT(A1,1)&"O"&RIGHT(A1,1)', '=REPLACE(A1,2,1,"O")', '=MID(A1,1,1)&"O"&MID(A1,3,1)', '=CONCAT(LEFT(A1,1),"O")'], hint: '& ç”¨æ–¼é€£æ¥æ–‡å­—', explanation: 'å€‹è³‡å»è­˜åˆ¥åŒ–å¸¸ç”¨æŠ€å·§ï¼Œç¬¦åˆé†«ç™‚éš±ç§ä¿è­·è¦ç¯„ã€‚', points: 170, color: 'bg-gradient-to-br from-red-400 to-pink-600' },
        { id: 15, category: 'è¤‡åˆå‡½æ•¸', situation: 'é¢¨éšªç­‰ç´šè©•ä¼°', question: 'A1ç‚ºæ”¶ç¸®å£“ï¼ŒB1ç‚ºèˆ’å¼µå£“ï¼Œè‹¥æ”¶ç¸®å£“â‰¥140æˆ–èˆ’å¼µå£“â‰¥90é¡¯ç¤º"é«˜è¡€å£“"ï¼Œå¦å‰‡"æ­£å¸¸"', correctAnswer: '=IF(OR(A1>=140,B1>=90),"é«˜è¡€å£“","æ­£å¸¸")', options: ['=IF(OR(A1>=140,B1>=90),"é«˜è¡€å£“","æ­£å¸¸")', '=IF(AND(A1>=140,B1>=90),"é«˜è¡€å£“","æ­£å¸¸")', '=IF(A1>=140,B1>=90,"é«˜è¡€å£“","æ­£å¸¸")', '=OR(A1>=140,B1>=90)'], hint: 'OR()æ»¿è¶³ä»»ä¸€æ¢ä»¶å³ç‚ºçœŸ', explanation: 'ORèˆ‡ANDæ˜¯é‚è¼¯åˆ¤æ–·çš„åŸºç¤ï¼Œç”¨æ–¼å¤šæŒ‡æ¨™ç¶œåˆè©•ä¼°ã€‚', points: 230, color: 'bg-gradient-to-br from-purple-500 to-fuchsia-700' }
      ];

      const spawnBalloon = useCallback(() => {
        const unanswered = questionBank.filter(q => !answeredIds.has(q.id));
        if (unanswered.length === 0) return;
        const question = unanswered[Math.floor(Math.random() * unanswered.length)];
        const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
        setBalloons(prev => [...prev, {
          id: Date.now() + Math.random(),
          questionId: question.id,
          question: { ...question, shuffledOptions },
          x: 10 + Math.random() * 80,
          y: 110
        }]);
      }, [answeredIds]);

      useEffect(() => {
        if (gameState !== 'playing') return;
        const spawnTimer = setInterval(() => { if (balloons.length < 8) spawnBalloon(); }, 2800);
        const moveTimer = setInterval(() => {
          setBalloons(prev => {
            const updated = prev.map(b => ({ ...b, y: b.y - 0.04 }));
            const escaped = updated.filter(b => b.y < -15);
            if (escaped.length > 0) {
              setLives(l => {
                const newLife = l - escaped.length;
                if (newLife <= 0) setTimeout(() => setGameState('gameover'), 10);
                return Math.max(0, newLife);
              });
              escaped.forEach(eb => {
                if (selectedBalloon?.id === eb.id) setSelectedBalloon(null);
              });
            }
            return updated.filter(b => b.y >= -15);
          });
        }, 40);
        return () => { clearInterval(spawnTimer); clearInterval(moveTimer); };
      }, [gameState, balloons.length, spawnBalloon, selectedBalloon]);

      const handleAnswer = (choice) => {
        if (!selectedBalloon || feedback) return;
        const isCorrect = choice === selectedBalloon.question.correctAnswer;
        if (isCorrect) {
          setFeedback({ type: 'success', message: 'ğŸ¯ æº–ç¢ºå‘½ä¸­ï¼', explanation: selectedBalloon.question.explanation });
          setScore(prev => prev + selectedBalloon.question.points);
          setAnsweredIds(prev => new Set([...prev, selectedBalloon.questionId]));
          setBalloons(prev => prev.filter(b => b.id !== selectedBalloon.id));
          setTimeout(() => {
            setSelectedBalloon(null);
            setFeedback(null);
            setShowHint(false);
            if (answeredIds.size + 1 === questionBank.length) setGameState('victory');
          }, 2500);
        } else {
          setFeedback({ type: 'error', message: 'âŒ åé›¢ç›®æ¨™', correctAnswer: selectedBalloon.question.correctAnswer });
          setLives(prev => prev - 1);
          if (lives <= 1) setTimeout(() => setGameState('gameover'), 2500);
          setTimeout(() => {
            setFeedback(null);
            setSelectedBalloon(null);
            setShowHint(false);
          }, 3000);
        }
      };

      const startGame = () => {
        setGameState('playing');
        setScore(0);
        setLives(5);
        setBalloons([]);
        setSelectedBalloon(null);
        setFeedback(null);
        setAnsweredIds(new Set());
        setShowHint(false);
      };

      return (
        <div className="min-h-screen bg-slate-50 font-sans">
          <div className="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-md">
            <div className="max-w-5xl mx-auto flex justify-between items-center">
              <div className="flex items-center gap-3">
                <Beaker className="text-blue-400" />
                <h1 className="text-xl font-bold tracking-tight">Biostat Excel Lab</h1>
              </div>
              {gameState === 'playing' && (
                <div className="flex gap-6">
                  <div className="flex items-center gap-2"><Trophy size={18} className="text-yellow-400" /> <span className="font-mono font-bold text-lg">{score}</span></div>
                  <div className="flex items-center gap-2">
                    {[...Array(5)].map((_, i) => (
                      <Heart key={i} size={18} fill={i < lives ? "#ef4444" : "none"} className={i < lives ? "text-red-500" : "text-slate-600"} />
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>

          <div className="max-w-5xl mx-auto p-6">
            {gameState === 'menu' && (
              <div className="text-center bg-white border border-slate-200 p-16 rounded-3xl shadow-sm mt-10">
                <div className="inline-block p-4 bg-blue-50 rounded-2xl mb-6">
                   <Target />
                </div>
                <h2 className="text-4xl font-black text-slate-800 mb-4">Excel å‡½æ•¸å¯¦é©—å®¤</h2>
                <p className="text-slate-500 mb-10 max-w-md mx-auto">é‡å°ç”Ÿç‰©çµ±è¨ˆèˆ‡è‡¨åºŠæ•¸æ“šè™•ç†è¨­è¨ˆçš„å°„æ“ŠéŠæˆ²ã€‚é»æ“Šä¸Šå‡çš„æ°£çƒï¼ŒæŒ‘æˆ°ä½ çš„å‡½æ•¸åæ‡‰åŠ›ã€‚</p>
                <button onClick={startGame} className="bg-blue-600 hover:bg-blue-700 text-white px-10 py-4 rounded-xl text-lg font-bold transition-all shadow-lg hover:shadow-blue-200">
                  é€²å…¥å¯¦é©—å®¤
                </button>
              </div>
            )}

            {gameState === 'playing' && (
              <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div className="lg:col-span-7 relative bg-slate-200 h-[600px] rounded-3xl overflow-hidden shadow-inner border-8 border-white">
                  <div className="absolute inset-0 opacity-20" style={{ backgroundImage: 'radial-gradient(#94a3b8 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>
                  {balloons.map(b => (
                    <div key={b.id} onClick={() => { if(!feedback) { setSelectedBalloon(b); setFeedback(null); setShowHint(false); }}}
                      className={`absolute cursor-pointer transition-all duration-300 ${selectedBalloon?.id === b.id ? 'scale-110 z-20' : 'hover:scale-105'}`}
                      style={{ left: `${b.x}%`, bottom: `${b.y}%` }}>
                      <div className={`w-20 h-24 ${b.question.color} rounded-t-full shadow-xl flex items-center justify-center text-white font-bold text-sm border-2 border-white/30 relative`}
                        style={{ borderRadius: '50% 50% 50% 50% / 60% 60% 40% 40%' }}>
                        {b.question.points}
                        {selectedBalloon?.id === b.id && <div className="absolute -inset-2 border-4 border-yellow-400 rounded-full" style={{animation: 'pulse 2s infinite'}}></div>}
                      </div>
                      <div className="w-0.5 h-10 bg-slate-400 mx-auto"></div>
                    </div>
                  ))}
                  {balloons.length === 0 && (
                    <div className="h-full flex items-center justify-center text-slate-400 font-medium">
                      æº–å‚™ç™¼å°„ä¸‹ä¸€çµ„æ•¸æ“šæ°£çƒ...
                    </div>
                  )}
                </div>

                <div className="lg:col-span-5">
                  {selectedBalloon ? (
                    <div className="bg-white p-6 rounded-3xl shadow-xl border border-slate-100">
                      <div className="flex justify-between items-center mb-6">
                        <span className="px-3 py-1 rounded-full bg-slate-100 text-slate-600 text-xs font-bold uppercase tracking-wider">
                          {selectedBalloon.question.category}
                        </span>
                        <button onClick={() => setShowHint(!showHint)} className="text-slate-400 hover:text-blue-500 transition-colors">
                          <Lightbulb size={20}/>
                        </button>
                      </div>
                      <div className="mb-6">
                        <h3 className="text-sm text-slate-400 mb-1 font-bold">ç ”ç©¶æƒ…å¢ƒ</h3>
                        <p className="text-slate-800 font-semibold leading-relaxed">{selectedBalloon.question.situation}</p>
                      </div>
                      <div className="bg-blue-50 p-4 rounded-2xl mb-6">
                        <h3 className="text-xs text-blue-400 mb-2 font-bold uppercase tracking-widest">ä»»å‹™ç›®æ¨™</h3>
                        <p className="text-blue-900 font-mono font-bold text-lg">{selectedBalloon.question.question}</p>
                      </div>
                      {showHint && (
                        <div className="bg-amber-50 border-l-4 border-amber-400 p-3 rounded-r-xl mb-6" style={{animation: 'pulse 2s infinite'}}>
                          <p className="text-sm text-amber-800 font-medium">ğŸ’¡ æç¤ºï¼š{selectedBalloon.question.hint}</p>
                        </div>
                      )}
                      <div className="space-y-3">
                        {selectedBalloon.question.shuffledOptions.map((opt, i) => (
                          <button key={i} onClick={() => handleAnswer(opt)} disabled={feedback !== null}
                            className="w-full text-left p-4 border-2 border-slate-100 hover:border-blue-500 hover:bg-blue-50 rounded-2xl transition-all font-mono text-sm disabled:opacity-50 group">
                            <span className="text-slate-300 mr-3 group-hover:text-blue-300 italic">{i+1}.</span>
                            {opt}
                          </button>
                        ))}
                      </div>
                      {feedback && (
                        <div className={`mt-6 p-4 rounded-2xl flex items-start gap-3 ${feedback.type === 'success' ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-red-50 text-red-700 border border-red-200'}`}
                          style={{animation: 'bounce 1s infinite'}}>
                          {feedback.type === 'success' ? <CheckCircle size={24}/> : <XCircle size={24}/>}
                          <div>
                            <p className="font-bold">{feedback.message}</p>
                            <p className="text-xs mt-1 opacity-80">{feedback.explanation || `{(gameState === 'gameover' || gameState === 'victory') && (
          <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl p-10 max-w-sm w-full text-center shadow-2xl">
              <div className="text-6xl mb-6">{gameState === 'victory' ? 'ğŸ†' : 'ğŸ”¬'}</div>
              <h2 className="text-3xl font-black mb-2">{gameState === 'victory' ? 'ç ”ç©¶å®Œæˆï¼' : 'å¯¦é©—ä¸­æ–·'}</h2>
              <p className="text-slate-500 mb-8 font-medium">æœ€çµ‚å¾—åˆ†ï¼š{score}</p>
              <button onClick={startGame} className="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-blue-700 transition-all shadow-lg">
                é‡æ–°é–‹å§‹å¯¦é©—
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

ReactDOM.render(<ExcelBalloonShooter />, document.getElementById('root'));